#!/bin/csh -f
### set env variables


## We need to create

set PATH    = /work/06091/nanr/
set COMPSET = FAMIPC5
set RESOLN  = ne120_ne120_mt12
set MACHINE = frontera
set TAG     = ihesp24
set TAG     = cesm-ihesp-hires1.0.31
setenv CESMROOT ${PATH}/cesm_tags/${TAG}/

set mbr = 99
set mbr = 97
setenv CASE f.e13.${COMPSET}.${RESOLN}.${TAG}_gen-restarts.00${mbr}

setenv CASEROOT /work/06091/nanr/frontera/cases/cesm13/$CASE
set RUNDIR   = /scratch1/06091/nanr/$CASE/run


# $CESMROOT/scripts/create_newcase -case $CASEROOT -res $RESOLN  -mach $MACHINE -compset $COMPSET -compiler $COMPILER
  $CESMROOT/cime/scripts/create_newcase --case $CASEROOT --res $RESOLN  --mach $MACHINE --compset $COMPSET --run-unsupported

cd $CASEROOT

### modify case parameters
./xmlchange RUN_TYPE=hybrid
./xmlchange STOP_OPTION=nyears
./xmlchange RUN_STARTDATE=1956-01-01
./xmlchange RUN_REFCASE=f.e13.FAMIPC5.ne120_ne120_mt12.cesm-ihesp-1950-2050.001
./xmlchange RUN_REFDATE=1956-01-01
./xmlchange STOP_N=5
./xmlchange GET_REFCASE=FALSE
./xmlchange DIN_LOC_ROOT='/glade/p/cesm/cseg/inputdata'
./xmlchange DIN_LOC_ROOT_CLMFORC='/glade/p/cesm/cseg/inputdata/atm/datm7'


 ./xmlchange REST_N=1
 ./xmlchange REST_OPTION=nmonths
 ./xmlchange DOUT_S_SAVE_INTERIM_RESTART_FILES=TRUE

 ./xmlchange NTASKS_ATM=2160
 ./xmlchange NTASKS_LND=2160
 ./xmlchange NTASKS_ICE=2160
 ./xmlchange NTASKS_OCN=2160
 ./xmlchange NTASKS_CPL=2160
 ./xmlchange NTASKS_ROF=2160

 ./xmlchange --append CAM_CONFIG_OPTS=-cosp


 ./xmlchange RUNDIR='/glade/scratch/nanr/$CASE/run'
 ./xmlchange EXEROOT='/glade/scratch/nanr/$CASE/bld'

 ./xmlchange ICE_DOMAIN_FILE=domain.ocn.ne120np4_tx0.1v2.191122.nc
 ./xmlchange OCN_DOMAIN_FILE=domain.ocn.ne120np4_tx0.1v2.191122.nc
 ./xmlchange SSTICE_GRID_FILENAME=/scratch1/06091/nanr/SST-highres/domain.ocn.0.25x0.25_mask.181109.nc
 ./xmlchange SSTICE_YEAR_ALIGN=1950
 ./xmlchange SSTICE_YEAR_START=1950
 ./xmlchange SSTICE_YEAR_END=2050

 ./xmlchange RUN_REFDIR=ccsm4_init
 ./xmlchange GET_REFCASE=FALSE

./case.setup

cp /home1/06091/nanr/CESM_tools/ihesp-tools/user_nl_files/gen-InitRestarts-AMIP-1950-2019/* $CASEROOT/

cp /work/02503/edwardsj/CESM/inputdata/ccsm4_init/f.e13.FAMIPC5.ne120_ne120_mt12.cesm-ihesp-1950-2050.001/rest/1956-01-01-00000/* /glade/scratch/nanr/$CASE/run

#qcmd -- ./case.build
