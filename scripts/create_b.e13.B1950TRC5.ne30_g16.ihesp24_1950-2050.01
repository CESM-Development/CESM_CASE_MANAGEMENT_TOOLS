#!/bin/csh -f
### set env variables


## We need to create
set COMPSET = B1950TRC5
set RESOLN  = ne30_g16
set MACHINE = cheyenne
set TAG     = ihesp24
#setenv CESMROOT /global/project/projectdirs/ccsm1/people/nanr/cesm_tags/cesm1_3_beta17_${TAG}
#setenv CESMROOT /glade/work/nanr/cesm_tags/cesm1_3_beta17_${TAG}
#setenv CESMROOT /glade/work/nanr/cesm_tags/sandbox/cesm1_3_beta17_sehires36
setenv CESMROOT /gpfs/fs1/work/nanr/cesm_tags/cesm-ihesp-hires1.0.24/

set mbr = 99
set mbr = 98
setenv CASE b.e13.${COMPSET}.${RESOLN}.${TAG}_1950-2050.00${mbr}
setenv CASEROOT /glade/work/nanr/ihesp-HiRes/cases/ne30_g16/$CASE


#$CESMROOT/scripts/create_newcase -case $CASEROOT -res $RESOLN  -mach $MACHINE -compset $COMPSET -compiler $COMPILER
 $CESMROOT/cime/scripts/create_newcase --case $CASEROOT --res $RESOLN  --mach $MACHINE --compset $COMPSET --run-unsupported

cd $CASEROOT

### modify case parameters
./xmlchange RUN_TYPE=hybrid
./xmlchange RUN_REFCASE=b.e13.B1950C5.ne30_g16.cesm-ihesp-NCPL-CESM1_MOD-ROF2OCN_RMAP_1950cntl.01
./xmlchange RUN_REFDATE=0031-01-01
./xmlchange GET_REFCASE=FALSE
./xmlchange STOP_OPTION=nyears
./xmlchange STOP_N=10
./xmlchange DIN_LOC_ROOT='/glade/p/cesm/cseg/inputdata'
./xmlchange DIN_LOC_ROOT_CLMFORC='/glade/p/cesm/cseg/inputdata/atm/datm7'
./xmlchange PIO_NETCDF_FORMAT_LND=64bit_offset

#./xmlchange PROJECT=P93300612

./xmlchange RUNDIR='/glade/scratch/nanr/$CASE/run'
./xmlchange EXEROOT='/glade/scratch/nanr/$CASE/bld'

./xmlchange --append CAM_CONFIG_OPTS=-cosp

 ./xmlchange NTASKS_ATM=2160
 ./xmlchange NTASKS_LND=864
 ./xmlchange NTASKS_ICE=1296
 ./xmlchange ROOTPE_ICE=864
 ./xmlchange NTASKS_OCN=1296
 ./xmlchange ROOTPE_OCN=2160
 ./xmlchange NTASKS_CPL=2160
 ./xmlchange NTASKS_ROF=864

 ./case.setup

 mv user_nl_cam user_nl_cam.`date +%m%d-%H%M`
 mv user_nl_clm user_nl_clm.`date +%m%d-%H%M`
 mv user_nl_cice user_nl_cice.`date +%m%d-%H%M`

 cp /glade/work/nanr/cesm_tags/CASE_tools/ihesp-tools/user_nl_files/* $CASEROOT
 cp /glade/work/nanr/cesm_tags/CASE_tools/ihesp-tools/SourceMods/src.pop/* $CASEROOT/SourceMods/src.pop/

 cp /glade/p/cesm/cseg/inputdata/ccsm4_init/b.e13.B1950C5.ne30_g16.cesm-ihesp-NCPL-CESM1_MOD-ROF2OCN_RMAP_1950cntl.01/0031-01-01/* /glade/scratch/nanr/$CASE/run



qcmd -- ./$CASE.build
